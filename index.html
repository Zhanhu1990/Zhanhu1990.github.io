<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>影视作品集 | 永久访问版</title>
  <!-- 引入外部依赖 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CBCB',
            dark: '#121212',
            darker: '#0A0A0A',
            light: '#F5F7FA'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.5s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            }
          }
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-xl hover:shadow-primary/20 hover:-translate-y-1;
      }
      .btn-primary {
        @apply bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2;
      }
      .btn-outline {
        @apply border border-primary text-primary hover:bg-primary/10 font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2;
      }
      .text-gradient {
        @apply bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary;
      }
    }
  </style>
  
  <!-- 基础样式 -->
  <style>
    body {
      scroll-behavior: smooth;
      margin: 0;
      padding: 0;
    }
    
    /* 滚动条样式 */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #1E1E1E;
    }
    ::-webkit-scrollbar-thumb {
      background: #165DFF;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #0F48D9;
    }
    
    /* 视频播放器样式 */
    .video-player {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* 模态框背景模糊 */
    .modal-backdrop {
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    
    /* 防止模态框内容溢出 */
    .modal-content {
      max-height: 90vh;
      overflow-y: auto;
    }
  </style>
</head>

<body class="bg-dark text-light font-inter min-h-screen flex flex-col">
  <!-- 导航栏 -->
  <header class="sticky top-0 z-50 bg-darker/80 backdrop-blur-md border-b border-gray-800">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center gap-2">
        <i class="fa fa-film text-primary text-2xl"></i>
        <h1 class="text-xl md:text-2xl font-bold">
          <span class="text-gradient">影视</span>作品集
        </h1>
      </div>
      
      <!-- 桌面端导航 -->
      <nav class="hidden md:flex items-center gap-6">
        <a href="#home" class="text-gray-300 hover:text-primary transition-colors">首页</a>
        <a href="#works" class="text-gray-300 hover:text-primary transition-colors">作品展示</a>
        <a href="#upload" class="text-gray-300 hover:text-primary transition-colors">上传作品</a>
        <a href="#about" class="text-gray-300 hover:text-primary transition-colors">关于我</a>
      </nav>
      
      <!-- 移动端菜单按钮 -->
      <button id="menuBtn" class="md:hidden text-gray-300 hover:text-primary text-xl">
        <i class="fa fa-bars"></i>
      </button>
    </div>
    
    <!-- 移动端导航菜单 -->
    <div id="mobileMenu" class="md:hidden hidden bg-darker border-t border-gray-800 animate-fade-in">
      <div class="container mx-auto px-4 py-2 flex flex-col gap-3">
        <a href="#home" class="py-2 text-gray-300 hover:text-primary transition-colors">首页</a>
        <a href="#works" class="py-2 text-gray-300 hover:text-primary transition-colors">作品展示</a>
        <a href="#upload" class="py-2 text-gray-300 hover:text-primary transition-colors">上传作品</a>
        <a href="#about" class="py-2 text-gray-300 hover:text-primary transition-colors">关于我</a>
      </div>
    </div>
  </header>

  <main class="flex-grow">
    <!-- 英雄区域 -->
    <section id="home" class="relative py-16 md:py-24 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-r from-darker to-dark z-0"></div>
      <div class="absolute inset-0 opacity-10">
        <img src="https://picsum.photos/id/1068/1920/1080" alt="背景" class="w-full h-full object-cover">
      </div>
      
      <div class="container mx-auto px-4 relative z-10">
        <div class="max-w-3xl animate-slide-up">
          <h2 class="text-[clamp(2rem,5vw,3.5rem)] font-bold leading-tight mb-4">
            记录光影 <span class="text-gradient">创作无限</span>
          </h2>
          <p class="text-gray-400 text-lg md:text-xl mb-8 max-w-2xl">
            永久存储你的影视作品，生成专属链接，随时查看和更新，所有内容保存在本地，安全隐私。
          </p>
          <div class="flex flex-wrap gap-4">
            <a href="#works" class="btn-primary">
              <i class="fa fa-th-large"></i> 浏览作品
            </a>
            <a href="#upload" class="btn-outline">
              <i class="fa fa-upload"></i> 上传新作品
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- 作品展示区域（核心：worksGrid 容器） -->
    <section id="works" class="py-16 bg-darker">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold mb-3">我的影视作品</h2>
          <p class="text-gray-400 max-w-2xl mx-auto">所有作品自动保存，刷新页面不丢失，按类别浏览</p>
        </div>
        
        <!-- 分类筛选 -->
        <div class="flex flex-wrap justify-center gap-3 mb-10">
          <button class="filter-btn active px-4 py-2 rounded-full bg-primary text-white transition-all" data-category="all">
            全部作品
          </button>
          <button class="filter-btn px-4 py-2 rounded-full bg-gray-800 text-gray-300 hover:bg-gray-700 transition-all" data-category="commercial-event">
            商业活动
          </button>
          <button class="filter-btn px-4 py-2 rounded-full bg-gray-800 text-gray-300 hover:bg-gray-700 transition-all" data-category="promo">
            宣传片
          </button>
          <button class="filter-btn px-4 py-2 rounded-full bg-gray-800 text-gray-300 hover:bg-gray-700 transition-all" data-category="tvc">
            TVC
          </button>
          <button class="filter-btn px-4 py-2 rounded-full bg-gray-800 text-gray-300 hover:bg-gray-700 transition-all" data-category="short-video">
            短视频
          </button>
        </div>
        
        <!-- 作品网格（动态加载数据库中的作品） -->
        <div id="worksGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          <!-- 加载中提示 -->
          <div id="loadingIndicator" class="col-span-full text-center py-10">
            <i class="fa fa-spinner fa-spin text-2xl text-primary mb-2"></i>
            <p class="text-gray-400">加载作品中...</p>
          </div>
          
          <!-- 无作品提示 -->
          <div id="noWorksTip" class="col-span-full text-center py-10 hidden">
            <i class="fa fa-film text-4xl text-gray-700 mb-4"></i>
            <p class="text-gray-400 text-lg">暂无作品，快去上传你的第一个创作吧！</p>
          </div>
        </div>
        
        <!-- 清除所有作品按钮 -->
        <div class="text-center mt-8">
          <button id="clearAllBtn" class="text-gray-500 hover:text-red-500 text-sm transition-colors flex items-center gap-1 mx-auto">
            <i class="fa fa-trash"></i> 清除所有作品（不可恢复）
          </button>
        </div>
      </div>
    </section>

    <!-- 上传作品区域 -->
    <section id="upload" class="py-16 bg-dark">
      <div class="container mx-auto px-4">
        <div class="max-w-3xl mx-auto bg-darker rounded-2xl p-6 md:p-8 border border-gray-800 shadow-xl">
          <div class="text-center mb-8">
            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold mb-2">上传新作品</h2>
            <p class="text-gray-400">作品自动保存，刷新页面不丢失，支持 MP4/MOV 格式</p>
          </div>
          
          <!-- 上传表单 -->
          <form id="uploadForm" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="workTitle" class="block text-gray-300 mb-2 text-sm font-medium">作品标题</label>
                <input type="text" id="workTitle" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-light focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="输入作品标题">
              </div>
              
              <div>
                <label for="workCategory" class="block text-gray-300 mb-2 text-sm font-medium">作品分类</label>
                <select id="workCategory" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-light focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
                  <option value="">选择分类</option>
                  <option value="commercial-event">商业活动</option>
                  <option value="promo">宣传片</option>
                  <option value="tvc">TVC</option>
                  <option value="short-video">短视频</option>
                </select>
              </div>
            </div>
            
            <div>
              <label for="workDescription" class="block text-gray-300 mb-2 text-sm font-medium">作品描述</label>
              <textarea id="workDescription" rows="3" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-light focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="简要描述作品内容、创作理念等"></textarea>
            </div>
            
            <!-- 封面上传 -->
            <div>
              <label class="block text-gray-300 mb-2 text-sm font-medium">作品封面</label>
              <div id="coverUpload" class="border-2 border-dashed border-gray-700 rounded-lg p-6 text-center hover:border-primary transition-all cursor-pointer bg-gray-800/50">
                <input type="file" id="coverFile" class="hidden" accept="image/*">
                <i class="fa fa-cloud-upload text-3xl text-gray-500 mb-2"></i>
                <p class="text-gray-400 mb-1">点击或拖拽文件到此处上传</p>
                <p class="text-gray-500 text-xs">支持 JPG、PNG 格式，建议尺寸 16:9</p>
                <div id="coverPreview" class="mt-4 hidden">
                  <img id="previewImage" src="" alt="封面预览" class="max-h-40 mx-auto rounded-md object-contain">
                </div>
              </div>
            </div>
            
            <!-- 视频上传 -->
            <div>
              <label class="block text-gray-300 mb-2 text-sm font-medium">作品视频</label>
              <div id="videoUpload" class="border-2 border-dashed border-gray-700 rounded-lg p-6 text-center hover:border-primary transition-all cursor-pointer bg-gray-800/50">
                <input type="file" id="videoFile" class="hidden" accept="video/*">
                <i class="fa fa-video-camera text-3xl text-gray-500 mb-2"></i>
                <p class="text-gray-400 mb-1">点击或拖拽视频文件到此处上传</p>
                <p class="text-gray-500 text-xs">支持 MP4、MOV 格式，建议大小不超过 500MB</p>
                <div id="videoInfo" class="mt-4 hidden">
                  <p id="videoFileName" class="text-gray-300 text-sm"></p>
                </div>
              </div>
            </div>
            
            <div class="pt-2">
              <button type="submit" class="w-full btn-primary justify-center">
                <i class="fa fa-save"></i> 保存作品（自动永久存储）
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- 关于我 + 链接生成区域 -->
    <section id="about" class="py-16 bg-darker">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
          <div class="flex flex-col md:flex-row gap-8 items-center">
            <div class="w-full md:w-1/3">
              <div class="relative">
                <div class="absolute -inset-1 bg-gradient-to-r from-primary to-secondary rounded-xl blur-md opacity-70"></div>
                <div class="relative bg-darker rounded-xl overflow-hidden">
                  <img src="https://picsum.photos/id/1012/400/400" alt="创作者头像" class="w-full h-auto object-cover">
                </div>
              </div>
            </div>
            
            <div class="w-full md:w-2/3">
              <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold mb-4">关于作品集</h2>
              <p class="text-gray-300 mb-4">
                这是一个支持永久存储的影视作品集，所有上传的内容保存在你的浏览器本地数据库中，刷新页面、重新打开链接都不会丢失。
              </p>
              <p class="text-gray-300 mb-6">
                生成专属链接后，你可以分享给他人（他人仅能查看自己上传的内容，你的内容隐私安全），随时更新和管理作品。
              </p>
              
              <!-- 链接生成区域 -->
              <div class="bg-gray-800 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
                  <i class="fa fa-link text-primary"></i> 你的专属链接
                </h3>
                <div class="flex flex-col sm:flex-row gap-3">
                  <input type="text" id="shareLink" class="flex-1 bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-light focus:outline-none focus:ring-2 focus:ring-primary/50" value="" readonly>
                  <button id="copyLinkBtn" class="btn-outline whitespace-nowrap">
                    <i class="fa fa-copy"></i> 复制链接
                  </button>
                </div>
                <p class="text-gray-500 text-xs mt-2">复制链接保存，下次直接打开即可查看所有作品</p>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div class="bg-gray-800 p-4 rounded-lg">
                  <h3 class="text-lg font-semibold mb-1" id="workCount">0</h3>
                  <p class="text-gray-400 text-sm">已保存作品</p>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg">
                  <h3 class="text-lg font-semibold mb-1">永久存储</h3>
                  <p class="text-gray-400 text-sm">本地数据库安全保存</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 视频播放器模态框 -->
  <div id="videoModal" class="fixed inset-0 z-50 hidden">
    <div class="modal-backdrop absolute inset-0 bg-black/90 flex items-center justify-center p-4">
      <div class="w-full max-w-4xl max-h-[90vh] animate-slide-up">
        <div class="relative">
          <!-- 关闭按钮 -->
          <button id="closeVideoModal" class="absolute top-4 right-4 w-12 h-12 rounded-full bg-black/70 flex items-center justify-center text-white hover:bg-primary transition-all z-20">
            <i class="fa fa-times text-xl"></i>
          </button>
          
          <!-- 视频播放器容器 -->
          <div class="aspect-video bg-black rounded-lg overflow-hidden">
            <video id="videoPlayer" class="video-player" controls autoplay>
              您的浏览器不支持HTML5视频播放。
            </video>
          </div>
          
          <!-- 视频信息 -->
          <div class="bg-darker p-4 rounded-b-lg border-t border-gray-800">
            <h3 id="videoTitle" class="text-xl font-bold mb-2 text-white">视频标题</h3>
            <div class="flex flex-wrap gap-2 text-sm">
              <span id="videoMeta" class="text-gray-400"><i class="fa fa-calendar mr-1"></i> 发布日期</span>
              <span class="text-gray-400"><i class="fa fa-eye mr-1"></i> 观看次数</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 作品详情模态框 -->
  <div id="workModal" class="fixed inset-0 z-50 hidden">
    <div class="modal-backdrop absolute inset-0 bg-black/80 flex items-center justify-center p-4">
      <div class="bg-darker rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto animate-slide-up">
        <div class="relative">
          <!-- 关闭按钮 -->
          <button id="closeModal" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-black/50 flex items-center justify-center text-white hover:bg-primary transition-all z-10">
            <i class="fa fa-times"></i>
          </button>
          
          <!-- 删除按钮 -->
          <button id="deleteWorkBtn" class="absolute top-4 left-4 w-10 h-10 rounded-full bg-red-900/50 flex items-center justify-center text-white hover:bg-red-600 transition-all z-10">
            <i class="fa fa-trash"></i>
          </button>
          
          <!-- 作品预览图 -->
          <div class="aspect-video bg-black">
            <img id="modalPreviewImage" src="https://picsum.photos/id/1005/1200/675" alt="作品预览" class="w-full h-full object-cover">
            <div class="absolute inset-0 flex items-center justify-center">
              <button id="modalPlayBtn" class="w-16 h-16 rounded-full bg-primary/90 hover:bg-primary text-white flex items-center justify-center transition-all transform hover:scale-110">
                <i class="fa fa-play text-xl"></i>
              </button>
            </div>
          </div>
          
          <!-- 作品信息 -->
          <div class="p-6">
            <div class="flex flex-wrap gap-2 mb-3">
              <span id="modalCategory" class="text-xs bg-primary/90 text-white px-2 py-1 rounded">商业活动</span>
              <span class="text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded"><i class="fa fa-calendar mr-1"></i> 2023.10.15</span>
              <span class="text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded"><i class="fa fa-eye mr-1"></i> 0 次观看</span>
            </div>
            
            <h3 id="modalTitle" class="text-2xl font-bold mb-3">城市之光</h3>
            
            <div class="prose prose-invert max-w-none mb-6">
              <p id="modalDescription">
                高端品牌发布会全程记录与制作，展现了活动的精彩瞬间和品牌理念，通过专业的镜头语言和剪辑手法，呈现出高端大气的视觉效果。
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 页脚 -->
  <footer class="bg-darker border-t border-gray-800 py-8">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex items-center gap-2">
          <i class="fa fa-film text-primary text-xl"></i>
          <span class="text-lg font-bold">
            <span class="text-gradient">影视</span>作品集
          </span>
        </div>
        
        <div class="text-gray-400 text-sm">
          © 2025 永久存储版 | 所有内容保存在本地
        </div>
      </div>
    </div>
  </footer>

  <!-- 核心 JavaScript（新增 IndexedDB 存储 + 永久链接） -->
  <script>
    // 全局变量
    let currentVideoInfo = {};
    let db; // IndexedDB 实例
    const DB_NAME = 'VideoPortfolioDB';
    const DB_VERSION = 1;
    const STORE_NAME = 'works';
    
    // 1. 初始化 IndexedDB 数据库（核心：永久存储）
    function initDB() {
      return new Promise((resolve, reject) => {
        // 打开数据库
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        // 数据库升级/创建时触发
        request.onupgradeneeded = (e) => {
          db = e.target.result;
          
          // 如果存储对象不存在，创建它（主键为 id）
          if (!db.objectStoreNames.contains(STORE_NAME)) {
            db.createObjectStore(STORE_NAME, { keyPath: 'id' });
          }
        };
        
        // 数据库打开成功
        request.onsuccess = (e) => {
          db = e.target.result;
          resolve(db);
        };
        
        // 数据库打开失败
        request.onerror = (e) => {
          reject('数据库初始化失败：' + e.target.error);
        };
      });
    }
    
    // 2. 数据库操作封装（增删查改）
    const DB = {
      // 添加作品
      addWork: (work) => {
        return new Promise((resolve, reject) => {
          const transaction = db.transaction(STORE_NAME, 'readwrite');
          const store = transaction.objectStore(STORE_NAME);
          const request = store.add(work);
          
          request.onsuccess = () => resolve(work);
          request.onerror = (e) => reject('添加作品失败：' + e.target.error);
        });
      },
      
      // 获取所有作品
      getAllWorks: () => {
        return new Promise((resolve, reject) => {
          const transaction = db.transaction(STORE_NAME, 'readonly');
          const store = transaction.objectStore(STORE_NAME);
          const request = store.getAll();
          
          request.onsuccess = (e) => resolve(e.target.result);
          request.onerror = (e) => reject('获取作品失败：' + e.target.error);
        });
      },
      
      // 根据 ID 删除作品
      deleteWork: (id) => {
        return new Promise((resolve, reject) => {
          const transaction = db.transaction(STORE_NAME, 'readwrite');
          const store = transaction.objectStore(STORE_NAME);
          const request = store.delete(id);
          
          request.onsuccess = () => resolve(true);
          request.onerror = (e) => reject('删除作品失败：' + e.target.error);
        });
      },
      
      // 清空所有作品
      clearAllWorks: () => {
        return new Promise((resolve, reject) => {
          const transaction = db.transaction(STORE_NAME, 'readwrite');
          const store = transaction.objectStore(STORE_NAME);
          const request = store.clear();
          
          request.onsuccess = () => resolve(true);
          request.onerror = (e) => reject('清空作品失败：' + e.target.error);
        });
      }
    };
    
    // 3. 页面加载时初始化数据库并加载作品
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // 初始化数据库
        await initDB();
        
        // 加载作品
        await loadAllWorks();
        
        // 生成分享链接
        generateShareLink();
        
        // 更新作品计数
        updateWorkCount();
        
      } catch (err) {
        console.error('初始化失败：', err);
        alert('作品集初始化失败，部分功能可能无法使用：' + err);
      }
      
      // 初始化其他功能
      initMobileMenu();
      initFilterButtons();
      initUploadPreview();
      initModalEvents();
      initUploadForm();
      initSmoothScroll();
      initClearAllBtn();
      initCopyLinkBtn();
    });
    
    // 4. 加载所有作品到页面
    async function loadAllWorks() {
      const worksGrid = document.getElementById('worksGrid');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const noWorksTip = document.getElementById('noWorksTip');
      
      try {
        const works = await DB.getAllWorks();
        
        // 隐藏加载提示
        loadingIndicator.classList.add('hidden');
        
        // 如果没有作品，显示提示
        if (works.length === 0) {
          noWorksTip.classList.remove('hidden');
          return;
        }
        
        // 隐藏无作品提示
        noWorksTip.classList.add('hidden');
        
        // 清空现有作品（避免重复）
        worksGrid.innerHTML = '';
        
        // 渲染作品卡片（按时间倒序排列，最新的在前面）
        works.sort((a, b) => new Date(b.createTime) - new Date(a.createTime)).forEach(work => {
          const workCard = createWorkCard(work);
          worksGrid.appendChild(workCard);
        });
        
      } catch (err) {
        console.error('加载作品失败：', err);
        loadingIndicator.innerHTML = `
          <i class="fa fa-exclamation-circle text-red-500 text-2xl mb-2"></i>
          <p class="text-gray-400">加载作品失败：${err}</p>
        `;
      }
    }
    
    // 5. 创建作品卡片（复用逻辑）
    function createWorkCard(work) {
      const categoryConfig = {
        'commercial-event': { name: '商业活动', color: 'bg-primary/90' },
        'promo': { name: '宣传片', color: 'bg-secondary/90' },
        'tvc': { name: 'TVC', color: 'bg-purple-500/90' },
        'short-video': { name: '短视频', color: 'bg-pink-500/90' }
      };
      const { name: categoryName, color: categoryColor } = categoryConfig[work.category] || { name: '未分类', color: 'bg-gray-500/90' };
      
      // 格式化日期
      const createTime = new Date(work.createTime);
      const dateStr = `${createTime.getFullYear()}.${String(createTime.getMonth() + 1).padStart(2, '0')}.${String(createTime.getDate()).padStart(2, '0')}`;
      
      // 创建卡片元素
      const card = document.createElement('div');
      card.className = 'work-card animate-fade-in';
      card.setAttribute('data-category', work.category);
      card.setAttribute('data-id', work.id); // 存储作品ID，用于删除/播放
      
      // 卡片HTML（封面用Base64，视频用临时Blob URL）
      card.innerHTML = `
        <div class="bg-gray-800 rounded-xl overflow-hidden card-hover group">
          <div class="relative aspect-video overflow-hidden">
            <img src="${work.coverBase64}" alt="${work.title}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-end">
              <div class="p-4">
                <span class="text-xs ${categoryColor} text-white px-2 py-1 rounded">${categoryName}</span>
                <h3 class="text-lg font-semibold mt-1">${work.title}</h3>
              </div>
            </div>
            <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/50">
              <button class="play-video-btn bg-primary/90 hover:bg-primary text-white w-12 h-12 rounded-full flex items-center justify-center transition-all transform group-hover:scale-110">
                <i class="fa fa-play"></i>
              </button>
            </div>
          </div>
          <div class="p-4">
            <p class="text-gray-400 text-sm mb-3">${work.description}</p>
            <div class="flex justify-between items-center">
              <span class="text-xs text-gray-500">${dateStr}</span>
              <div class="flex gap-2">
                <span class="text-xs text-gray-500"><i class="fa fa-eye mr-1"></i> ${work.viewCount || 0}</span>
                <span class="text-xs text-gray-500"><i class="fa fa-heart mr-1"></i> ${work.likeCount || 0}</span>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // 绑定播放按钮事件
      const playBtn = card.querySelector('.play-video-btn');
      playBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        openVideoPlayerByWork(work);
      });
      
      // 绑定卡片点击事件（打开详情）
      card.addEventListener('click', () => openWorkDetailByWork(work));
      
      return card;
    }
    
    // 6. 打开作品详情模态框（通过作品对象）
    function openWorkDetailByWork(work) {
      const categoryConfig = {
        'commercial-event': { name: '商业活动', color: 'bg-primary/90' },
        'promo': { name: '宣传片', color: 'bg-secondary/90' },
        'tvc': { name: 'TVC', color: 'bg-purple-500/90' },
        'short-video': { name: '短视频', color: 'bg-pink-500/90' }
      };
      const { name: categoryName, color: categoryColor } = categoryConfig[work.category] || { name: '未分类', color: 'bg-gray-500/90' };
      
      // 格式化日期
      const createTime = new Date(work.createTime);
      const dateStr = `${createTime.getFullYear()}.${String(createTime.getMonth() + 1).padStart(2, '0')}.${String(createTime.getDate()).padStart(2, '0')}`;
      
      // 存储当前作品信息（用于播放和删除）
      currentVideoInfo = { ...work };
      
      // 更新模态框内容
      document.getElementById('modalTitle').textContent = work.title;
      document.getElementById('modalPreviewImage').src = work.coverBase64;
      document.getElementById('modalDescription').textContent = work.description;
      
      // 更新分类标签
      const categoryTag = document.getElementById('modalCategory');
      categoryTag.className = `text-xs ${categoryColor} text-white px-2 py-1 rounded`;
      categoryTag.textContent = categoryName;
      
      // 更新元信息
      const metaTags = document.querySelectorAll('#modalCategory + span');
      metaTags[0].innerHTML = `<i class="fa fa-calendar mr-1"></i> ${dateStr}`;
      metaTags[1].innerHTML = `<i class="fa fa-eye mr-1"></i> ${work.viewCount || 0} 次观看`;
      
      // 显示模态框
      document.getElementById('workModal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    // 7. 打开视频播放器（通过作品对象）
    function openVideoPlayerByWork(work) {
      // 从作品对象的 videoBlob 生成临时 URL
      const videoBlob = new Blob([new Uint8Array(work.videoBlob)], { type: work.videoType });
      const videoUrl = URL.createObjectURL(videoBlob);
      
      // 存储当前视频信息
      const createTime = new Date(work.createTime);
      const dateStr = `${createTime.getFullYear()}.${String(createTime.getMonth() + 1).padStart(2, '0')}.${String(createTime.getDate()).padStart(2, '0')}`;
      
      currentVideoInfo = {
        videoUrl,
        title: work.title,
        date: dateStr,
        views: work.viewCount || 0,
        blob: videoBlob // 保存Blob引用，避免垃圾回收
      };
      
      // 更新播放器
      const videoPlayer = document.getElementById('videoPlayer');
      const videoTitle = document.getElementById('videoTitle');
      const videoMeta = document.getElementById('videoMeta');
      
      // 清除旧的source
      while (videoPlayer.firstChild) {
        videoPlayer.removeChild(videoPlayer.firstChild);
      }
      
      // 添加新的source
      const newSource = document.createElement('source');
      newSource.src = videoUrl;
      newSource.type = work.videoType;
      videoPlayer.appendChild(newSource);
      
      // 更新信息并播放
      videoTitle.textContent = work.title;
      videoMeta.innerHTML = `<i class="fa fa-calendar mr-1"></i> ${dateStr}`;
      videoPlayer.load();
      videoPlayer.play().catch(err => {
        console.error('播放失败：', err);
        alert('视频播放失败，请检查文件格式或浏览器权限：' + err);
      });
      
      // 显示播放器模态框
      document.getElementById('videoModal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    // 8. 上传作品表单提交（保存到数据库）
    async function initUploadForm() {
      const uploadForm = document.getElementById('uploadForm');
      
      uploadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // 表单验证
        const title = document.getElementById('workTitle').value.trim();
        const category = document.getElementById('workCategory').value;
        const description = document.getElementById('workDescription').value.trim();
        const coverFile = document.getElementById('coverFile').files[0];
        const videoFile = document.getElementById('videoFile').files[0];
        
        if (!title) return alert('请输入作品标题');
        if (!category) return alert('请选择作品分类');
        if (!description) return alert('请输入作品描述');
        if (!coverFile) return alert('请上传作品封面');
        if (!videoFile) return alert('请上传作品视频');
        
        // 禁用提交按钮，防止重复提交
        const submitBtn = uploadForm.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 保存中...';
        
        try {
          // 读取封面为Base64
          const coverBase64 = await readFileAsBase64(coverFile);
          
          // 读取视频为Uint8Array（适合数据库存储）
          const videoArray = await readFileAsArrayBuffer(videoFile);
          const videoBlob = Array.from(new Uint8Array(videoArray)); // 转换为数组存储
          
          // 构建作品对象
          const work = {
            id: 'work_' + Date.now(), // 唯一ID
            title,
            category,
            description,
            coverBase64,
            videoBlob, // 视频二进制数据（数组形式）
            videoType: videoFile.type, // 视频MIME类型
            createTime: new Date().toISOString(), // 创建时间
            viewCount: 0, // 观看次数
            likeCount: 0 // 点赞次数
          };
          
          // 保存到数据库
          await DB.addWork(work);
          
          // 重新加载作品列表
          await loadAllWorks();
          
          // 更新作品计数
          updateWorkCount();
          
          // 重置表单
          uploadForm.reset();
          document.getElementById('coverPreview').classList.add('hidden');
          document.getElementById('videoInfo').classList.add('hidden');
          
          // 提示成功并滚动到新作品
          alert('作品上传成功！已自动保存，刷新页面不丢失');
          const newWorkCard = document.querySelector('.work-card:first-child');
          if (newWorkCard) {
            newWorkCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
          
        } catch (err) {
          console.error('上传作品失败：', err);
          alert('作品上传失败：' + err);
        } finally {
          // 恢复提交按钮
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="fa fa-save"></i> 保存作品（自动永久存储）';
        }
      });
    }
    
    // 工具函数：读取文件为Base64
    function readFileAsBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.onerror = (e) => reject('读取文件失败：' + e.target.error);
        reader.readAsDataURL(file);
      });
    }
    
    // 工具函数：读取文件为ArrayBuffer（用于视频存储）
    function readFileAsArrayBuffer(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.onerror = (e) => reject('读取视频失败：' + e.target.error);
        reader.readAsArrayBuffer(file);
      });
    }
    
    // 9. 删除作品功能
    async function deleteCurrentWork() {
      if (!currentVideoInfo.id) return alert('没有选中的作品');
      
      if (!confirm('确定要删除这个作品吗？删除后不可恢复！')) return;
      
      try {
        // 从数据库删除
        await DB.deleteWork(currentVideoInfo.id);
        
        // 关闭模态框
        document.getElementById('workModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        
        // 重新加载作品列表
        await loadAllWorks();
        
        // 更新作品计数
        updateWorkCount();
        
        alert('作品删除成功');
        
      } catch (err) {
        console.error('删除作品失败：', err);
        alert('删除作品失败：' + err);
      }
    }
    
    // 10. 清空所有作品功能
    function initClearAllBtn() {
      const clearAllBtn = document.getElementById('clearAllBtn');
      
      clearAllBtn.addEventListener('click', async () => {
        if (!confirm('确定要清除所有作品吗？所有数据将永久丢失，不可恢复！')) return;
        
        try {
          await DB.clearAllWorks();
          
          // 重新加载作品列表
          await loadAllWorks();
          
          // 更新作品计数
          updateWorkCount();
          
          alert('所有作品已清除');
          
        } catch (err) {
          console.error('清空作品失败：', err);
          alert('清空作品失败：' + err);
        }
      });
    }
    
    // 11. 生成分享链接（当前页面URL）
    function generateShareLink() {
      const shareLinkInput = document.getElementById('shareLink');
      // 当前页面URL就是分享链接（部署后可永久访问）
      shareLinkInput.value = window.location.href;
    }
    
    // 12. 复制链接功能
    function initCopyLinkBtn() {
      const copyLinkBtn = document.getElementById('copyLinkBtn');
      const shareLinkInput = document.getElementById('shareLink');
      
      copyLinkBtn.addEventListener('click', () => {
        shareLinkInput.select();
        document.execCommand('copy');
        copyLinkBtn.innerHTML = '<i class="fa fa-check"></i> 已复制';
        setTimeout(() => {
          copyLinkBtn.innerHTML = '<i class="fa fa-copy"></i> 复制链接';
        }, 2000);
      });
    }
    
    // 13. 更新作品计数
    async function updateWorkCount() {
      try {
        const works = await DB.getAllWorks();
        document.getElementById('workCount').textContent = works.length;
      } catch (err) {
        console.error('更新作品计数失败：', err);
      }
    }
    
    // 以下是原有功能的初始化（保持不变）
    function initMobileMenu() {
      const menuBtn = document.getElementById('menuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        menuBtn.innerHTML = mobileMenu.classList.contains('hidden') ? '<i class="fa fa-bars"></i>' : '<i class="fa fa-times"></i>';
      });
    }
    
    function initFilterButtons() {
      const filterBtns = document.querySelectorAll('.filter-btn');
      filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          filterBtns.forEach(b => {
            b.classList.remove('active', 'bg-primary', 'text-white');
            b.classList.add('bg-gray-800', 'text-gray-300');
          });
          btn.classList.add('active', 'bg-primary', 'text-white');
          
          const category = btn.getAttribute('data-category');
          document.querySelectorAll('.work-card').forEach(card => {
            card.style.display = category === 'all' || card.getAttribute('data-category') === category 
              ? 'block' 
              : 'none';
          });
        });
      });
    }
    
    function initUploadPreview() {
      // 封面预览
      const coverUpload = document.getElementById('coverUpload');
      const coverFile = document.getElementById('coverFile');
      const coverPreview = document.getElementById('coverPreview');
      const previewImage = document.getElementById('previewImage');
      
      coverUpload.addEventListener('click', () => coverFile.click());
      coverFile.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            previewImage.src = event.target.result;
            coverPreview.classList.remove('hidden');
          };
          reader.readAsDataURL(file);
        }
      });
      
      // 视频预览
      const videoUpload = document.getElementById('videoUpload');
      const videoFile = document.getElementById('videoFile');
      const videoInfo = document.getElementById('videoInfo');
      const videoFileName = document.getElementById('videoFileName');
      
      videoUpload.addEventListener('click', () => videoFile.click());
      videoFile.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          videoFileName.textContent = `已选择: ${file.name} (${formatFileSize(file.size)})`;
          videoInfo.classList.remove('hidden');
        }
      });
    }
    
    function initModalEvents() {
      // 关闭视频模态框
      document.getElementById('closeVideoModal').addEventListener('click', () => {
        document.getElementById('videoModal').classList.add('hidden');
        document.getElementById('videoPlayer').pause();
        // 释放Blob URL，避免内存泄漏
        if (currentVideoInfo.videoUrl) {
          URL.revokeObjectURL(currentVideoInfo.videoUrl);
          currentVideoInfo.videoUrl = null;
        }
        document.body.style.overflow = 'auto';
      });
      
      // 关闭作品详情模态框
      document.getElementById('closeModal').addEventListener('click', () => {
        document.getElementById('workModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
      });
      
      // 作品详情模态框播放按钮
      document.getElementById('modalPlayBtn').addEventListener('click', () => {
        if (!currentVideoInfo.id) {
          alert('没有选中的作品');
          return;
        }
        openVideoPlayerByWork(currentVideoInfo);
        document.getElementById('workModal').classList.add('hidden');
      });
      
      // 删除作品按钮
      document.getElementById('deleteWorkBtn').addEventListener('click', deleteCurrentWork);
      
      // 点击模态框背景关闭
      document.getElementById('videoModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('videoModal')) {
          document.getElementById('videoModal').classList.add('hidden');
          document.getElementById('videoPlayer').pause();
          if (currentVideoInfo.videoUrl) {
            URL.revokeObjectURL(currentVideoInfo.videoUrl);
            currentVideoInfo.videoUrl = null;
          }
          document.body.style.overflow = 'auto';
        }
      });
      
      document.getElementById('workModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('workModal')) {
          document.getElementById('workModal').classList.add('hidden');
          document.body.style.overflow = 'auto';
        }
      });
    }
    
    function initSmoothScroll() {
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            window.scrollTo({
              top: target.offsetTop - 80,
              behavior: 'smooth'
            });
            
            // 关闭移动端菜单
            const mobileMenu = document.getElementById('mobileMenu');
            const menuBtn = document.getElementById('menuBtn');
            if (!mobileMenu.classList.contains('hidden')) {
              mobileMenu.classList.add('hidden');
              menuBtn.innerHTML = '<i class="fa fa-bars"></i>';
            }
          }
        });
      });
    }
    
    // 文件大小格式化工具函数
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
  </script>
</body>
</html>
